import{_ as e}from"../TableData/TableData.8ec0cfb4.js";import{d as a,ai as l,r as t,t as s,N as d,b as o,w as n,aj as c,o as i,e as u,ak as r,j as h,i as m,U as p,al as f,l as k,S as _,D as g,V as w,ag as b,ah as v,am as y,v as x,f as E,x as R,z as S,an as A,ao as U,ap as M,aq as j,af as q,y as C,ar as D,p as F,k as $,ad as I}from"../.pnpm/.pnpm.66cdfca9.js";import{_ as T}from"../../assets/index.eb4846d5.js";const V=a({components:{Info16Regular:l},setup(){const e=t([]),a=s("reload");return{isShow:t(!1),isEdit:t(!1),loading:t(!1),menuRole:e,upArrSelect:()=>{e.value.forEach((e=>{let a=0;e.child.forEach((e=>{e.checked&&(a+=1),e.child&&e.child.forEach((e=>{e.checked&&(a+=1)}))})),e.own=a,e.sumRole==a?e.selectAll=!0:e.selectAll=!1}))},model:t({id:null,name:""}),reload:a}},methods:{async show(e){this.isShow=!0,this.isEdit=e.isEdit,this.model.id=e.id;const{data:a}=await this.$http.get("admin/api/admin-group/view?id="+e.id);a&&(this.menuRole=a.menuRole,this.model.name=a.name)},async submitFunc(){this.loading=!0;const e={...this.model,data:this.menuRole},{data:a,msg:l}=await this.$http.post("admin/api/admin-group/update",e);a&&(window.$message.success(l),this.isShow=!1,this.reload(),await this.$store.dispatch("auth/authentication")),this.loading=!1},updateAllSelect(e,a){const l=this.menuRole[a];l.selectAll=e,l.own=e?l.sumRole:0,l.child.forEach((a=>{a.checked=e,a.child&&a.child.length>0&&a.child.forEach((a=>{a.checked=e}))}))}}}),z=e=>(F("data-v-e66da888"),e=e(),$(),e),B={class:"label"},G=z((()=>k("div",{class:"text-sm text-stone-400 mb-1"},"菜单",-1))),H=z((()=>k("div",{class:"text-sm text-stone-400 mt-2"},"权限",-1))),N={class:"flex h-10 items-center font-bold"};const J=T(a({name:"AdminGroup",components:{TableData:e,FormModal:T(V,[["render",function(e,a,l,t,s,F){const $=b,I=v,T=y,V=x,z=E("Info16Regular"),J=d,K=R,L=S,O=A,P=U,Q=M,W=j,X=q,Y=C,Z=D,ee=c;return i(),o(ee,{show:e.isShow,"onUpdate:show":a[3]||(a[3]=a=>e.isShow=a),width:"68%",placement:"right","auto-focus":!1},{default:n((()=>[u(Z,{title:""},{default:n((()=>[u(L,{bordered:!1},r({default:n((()=>[u(X,{"label-width":"auto"},{default:n((()=>[u(I,{label:"名称","show-require-mark":"",class:"w-1/3"},{default:n((()=>[u($,{value:e.model.name,"onUpdate:value":a[0]||(a[0]=a=>e.model.name=a),placeholder:"请输入部门名称"},null,8,["value"])])),_:1}),u(I,{label:"权限","show-require-mark":""},{default:n((()=>[u(L,null,{default:n((()=>[u(W,{"arrow-placement":"right",class:"menu-rule-auth-box"},{default:n((()=>[(i(!0),m(w,null,p(e.menuRole,((l,t)=>(i(),o(Q,{name:"menu_"+t,key:"menu_"+t},{header:n((()=>[u(V,{quaternary:"",class:"m-btn",onClick:a[1]||(a[1]=f((()=>{}),["stop"]))},{default:n((()=>[u(T,{"onUpdate:checked":[a=>e.updateAllSelect(a,t),e=>l.selectAll=e],checked:l.selectAll},null,8,["onUpdate:checked","checked"]),k("div",B,[h(_(l.name)+" ",1),k("span",{class:g(l.own==l.sumRole?"bg-green-500 text-white":"bg-stone-100")},_(l.own)+"/"+_(l.sumRole),3)])])),_:2},1024)])),default:n((()=>[u(P,{cols:"2 m:3 l:4","x-gap":"12","y-gap":12,responsive:"screen"},{default:n((()=>[(i(!0),m(w,null,p(l.child,((a,l)=>(i(),o(O,{key:"page_"+l},{default:n((()=>[u(L,null,{default:n((()=>[G,u(T,{class:"text-base font-bold",checked:a.checked,"onUpdate:checked":[e=>a.checked=e,e.upArrSelect]},{default:n((()=>[h(_(a.name),1)])),_:2},1032,["checked","onUpdate:checked"]),H,(i(!0),m(w,null,p(a.child,((a,l)=>(i(),m("div",N,[u(T,{checked:a.checked,"onUpdate:checked":[e=>a.checked=e,e.upArrSelect]},{default:n((()=>[h(_(a.name),1)])),_:2},1032,["checked","onUpdate:checked"]),u(K,{trigger:"click"},{trigger:n((()=>[u(V,{quaternary:"",circle:"",class:"text-xl"},{default:n((()=>[u(J,null,{default:n((()=>[u(z)])),_:1})])),_:1})])),default:n((()=>[h(" "+_(a.typeDes),1)])),_:2},1024)])))),256))])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1032,["name"])))),128))])),_:1})])),_:1})])),_:1})])),_:1})])),_:2},[e.isEdit?{name:"footer",fn:n((()=>[u(Y,{justify:"end"},{default:n((()=>[u(V,{type:"default",onClick:a[2]||(a[2]=a=>e.isShow=!1),strong:"",secondary:""},{default:n((()=>[h("取消")])),_:1}),u(V,{type:"primary",onClick:e.submitFunc,loading:e.loading},{default:n((()=>[h("保存")])),_:1},8,["onClick","loading"])])),_:1})])),key:"0"}:void 0]),1024)])),_:1})])),_:1},8,["show"])}],["__scopeId","data-v-e66da888"]])},setup(){let e=I({name:""});return{selectedValue:t(null),search:e}},methods:{}}),[["render",function(a,l,t,s,d,o){const c=x,r=b,p=e,f=E("FormModal");return i(),m("div",null,[u(p,{subHeight:240,search:a.search,ref:"tables",onView:l[2]||(l[2]=e=>a.openModal({id:e.id,isEdit:!1},"formModal")),onEdit:l[3]||(l[3]=e=>a.openModal({id:e.id,isEdit:!0},"formModal")),url:"admin/api/admin-group/index",handle:a._handleBtn},{btn:n((()=>[u(c,{quaternary:"",onClick:l[0]||(l[0]=e=>a.openModal({id:null,isEdit:!0},"formModal"))},{default:n((()=>[h("创建")])),_:1})])),default:n((()=>[u(r,{value:a.search.name,"onUpdate:value":l[1]||(l[1]=e=>a.search.name=e),filterable:"",placeholder:"部门名称"},null,8,["value"])])),_:1},8,["search","handle"]),u(f,{ref:"formModal"},null,512)])}]]);export{J as default};
