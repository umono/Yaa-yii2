import{_ as e}from"../TableData/TableData.8ec0cfb4.js";import{a,_ as s}from"../../assets/index.eb4846d5.js";import{d as o,r as l,i as t,b as d,e as n,w as i,V as r,E as u,aE as m,o as h,j as c,v as p,t as f,ak as w,aF as g,au as v,l as y,A as b,U as _,S as k,f as S,ag as C,ah as U,aG as F,y as $,aH as x,af as M,ad as P}from"../.pnpm/.pnpm.66cdfca9.js";const E=o({props:["src","fileName"],emits:["upSuccess"],setup(e,s){const o=l({"X-Access-Token":a.getAccessToken(),"X-Client-Id":a.getClientId()});let t=e.fileName;t||(t="img");return{fileName:t,url:"http://localhost:9527/admin/api/upload/photo",headers:o,handleFinish:({file:e,event:a})=>{const o=null==a?void 0:a.target,l=JSON.parse(o.response);return 200!=l.code?window.$message.error(l.msg||"上传失败:("):(s.emit("upSuccess",l.data.url),e)}}},methods:{uploadFile(){}}}),N={key:1,class:"border-dashed border border-gray-300 mb-2 mt-8",style:{width:"180px",height:"180px"}};const z=o({components:{UploadPhoto:s(E,[["render",function(e,a,s,o,l,f){const w=u,g=p,v=m;return h(),t(r,null,[e.src?(h(),d(w,{key:0,width:"200",height:"200",class:"mb-2 mt-8",src:e.src,"object-fit":"cover"},null,8,["src"])):(h(),t("div",N)),n(v,{action:e.url,headers:e.headers,onFinish:e.handleFinish,name:e.fileName,"show-file-list":!1},{default:i((()=>[n(g,null,{default:i((()=>[c("上传文件")])),_:1})])),_:1},8,["action","headers","onFinish","name"])],64)}]])},setup(e,a){const s=f("reload");return{isShow:l(!1),isEdit:l(!1),loading:l(!1),model:l({id:null}),reload:s,groups:l([])}},methods:{async show(e){this.isShow=!0,this.model.id=e.id,this.isEdit=e.isEdit;const{data:a}=await this.$http.get("admin/api/admin/view?id="+e.id);a&&(e.id?this.model=a.admin:this.model={},this.groups=a.groups)},async submitFunc(){this.loading=!0;const{data:e,msg:a}=await this.$http.post("admin/api/admin/update",this.model);if(e){const e=this.$store.getters["auth/getUser"],s=JSON.parse(JSON.stringify(e));s.id==this.model.id&&(s.avatar=this.model.avatar,s.name=this.model.name,s.username=this.model.username,this.$store.dispatch("auth/updateUser",s)),window.$message.success(a),this.isShow=!1,this.reload()}this.loading=!1},upPhoto(e){this.model.avatar=e}}}),B={class:"custom-card",style:{"margin-top":"-30px"}},T={class:"flex mb-8"},j={class:"w-1/2"},I={class:"w-1/2"},A=y("div",{class:"text-gray-400 my-1"},"电话号码",-1),G=y("div",{class:"text-gray-400 my-1"},"姓名",-1),q=y("div",{class:"text-gray-400 my-1"},"用户昵称",-1),D=y("div",{class:"text-gray-400 my-1"},"邮箱",-1);const J=s(z,[["render",function(e,a,s,o,l,u){const m=S("UploadPhoto"),f=C,P=U,E=F,N=$,z=x,J=M,O=p,H=g;return h(),d(H,{show:e.isShow,"onUpdate:show":a[8]||(a[8]=a=>e.isShow=a),"close-on-esc":!1,"mask-closable":!1,preset:"card",bordered:!0,style:"width:45%",onClose:a[9]||(a[9]=a=>e.isShow=!1),title:"员工信息"},w({default:i((()=>[y("div",B,[n(J,{ref:"formRef",model:e.model,"label-placement":"top","label-width":"auto","require-mark-placement":"right-hanging"},{default:i((()=>[y("div",T,[y("div",j,[n(m,{src:e.model.avatar,onUpSuccess:e.upPhoto},null,8,["src","onUpSuccess"])]),y("div",I,[A,n(f,{value:e.model.phone,"onUpdate:value":a[0]||(a[0]=a=>e.model.phone=a),placeholder:"请输入电话号码"},null,8,["value"]),G,n(f,{value:e.model.name,"onUpdate:value":a[1]||(a[1]=a=>e.model.name=a),placeholder:"请输入姓名"},null,8,["value"]),q,n(f,{value:e.model.username,"onUpdate:value":a[2]||(a[2]=a=>e.model.username=a),placeholder:"请输入用户名称"},null,8,["value"]),D,n(f,{value:e.model.email,"onUpdate:value":a[3]||(a[3]=a=>e.model.email=a),placeholder:"请输入邮箱"},null,8,["value"])])]),e.model.id?b("",!0):(h(),d(P,{key:0,label:"密码"},{default:i((()=>[n(f,{type:"password",value:e.model.password,"onUpdate:value":a[4]||(a[4]=a=>e.model.password=a),"input-props":{autocomplete:"off"},placeholder:"请输入密码"},null,8,["value"])])),_:1})),e.model.id?b("",!0):(h(),d(P,{key:1,label:"重复密码"},{default:i((()=>[n(f,{value:e.model.passwordConfirm,"onUpdate:value":a[5]||(a[5]=a=>e.model.passwordConfirm=a),"input-props":{autocomplete:"off"},type:"password",placeholder:"请重复输入密码"},null,8,["value"])])),_:1})),n(P,{label:"所属部门"},{default:i((()=>[n(z,{value:e.model.adminGroupId,"onUpdate:value":a[6]||(a[6]=a=>e.model.adminGroupId=a),name:"radiogroup"},{default:i((()=>[n(N,null,{default:i((()=>[(h(!0),t(r,null,_(e.groups,((e,a)=>(h(),d(E,{key:"ra-group-"+a,value:e.id},{default:i((()=>[c(k(e.name),1)])),_:2},1032,["value"])))),128))])),_:1})])),_:1},8,["value"])])),_:1})])),_:1},8,["model"])])])),_:2},[e.isEdit?{name:"footer",fn:i((()=>[v(e.$slots,"footer",{},(()=>[n(N,null,{default:i((()=>[n(O,{onClick:a[7]||(a[7]=a=>e.isShow=!1),strong:"",secondary:""},{default:i((()=>[c("取消")])),_:1}),n(O,{strong:"",secondary:"",type:"primary",onClick:e.submitFunc,loading:e.loading},{default:i((()=>[c("保存")])),_:1},8,["onClick","loading"])])),_:1})]))])),key:"0"}:void 0]),1032,["show"])}]]),O=o({setup:(e,a)=>({isShow:l(!1),loading:l(!1),model:l({id:null})}),methods:{async show(e){this.isShow=!0,this.model=e},async submitFunc(){this.loading=!0;const{data:e,msg:a}=await this.$http.post("admin/api/admin/change-password",this.model);e&&(window.$message.success(a),this.isShow=!1),this.loading=!1}}}),H={class:"text-base font-bold"},R=y("span",{class:"text-gray-400"},"修改账号：",-1);const V=s(o({name:"Admin",components:{TableData:e,FormModal:J,ChangePasswordModal:s(O,[["render",function(e,a,s,o,l,t){const r=C,u=U,m=M,f=p,b=$,_=g;return h(),d(_,{show:e.isShow,"onUpdate:show":a[2]||(a[2]=a=>e.isShow=a),"close-on-esc":!1,"mask-closable":!1,preset:"card",bordered:!0,style:"width:45%",onClose:a[3]||(a[3]=a=>e.isShow=!1),title:"修改密码"},w({default:i((()=>[y("div",null,[n(m,{ref:"formRef",model:e.model,"label-placement":"top","label-width":"auto","require-mark-placement":"right-hanging"},{default:i((()=>[y("div",H,[R,c(" "+k(e.model.username),1)]),n(u,{label:""},{default:i((()=>[n(r,{type:"password",value:e.model.password,"onUpdate:value":a[0]||(a[0]=a=>e.model.password=a),"input-props":{autocomplete:"off"},placeholder:"请输入新密码"},null,8,["value"])])),_:1})])),_:1},8,["model"])])])),_:2},[e.$can("admin/change-password")?{name:"footer",fn:i((()=>[v(e.$slots,"footer",{},(()=>[n(b,null,{default:i((()=>[n(f,{onClick:a[1]||(a[1]=a=>e.isShow=!1),strong:"",secondary:""},{default:i((()=>[c("取消")])),_:1}),n(f,{strong:"",secondary:"",type:"primary",onClick:e.submitFunc,loading:e.loading},{default:i((()=>[c("保存")])),_:1},8,["onClick","loading"])])),_:1})]))])),key:"0"}:void 0]),1032,["show"])}]])},setup:()=>({search:P({phone:"",username:"",adminGroupId:null}),model:P({})}),mounted(){setTimeout((()=>{if(this.$can("admin/freeze")){const e={type:"warning",text:e=>10==e.status?"冻结":"解冻",emitFunction:"freeze"};this._handleBtn[0].NButtons.push(e)}if(this.$can("admin/change-password")){const e={type:"error",text:"修改密码",emitFunction:"changePassword"};this._handleBtn[0].NButtons.push(e),this._handleBtn[0].width=280}}),100)},methods:{async freeze(e){const{data:a,msg:s}=await this.$http.post("admin/api/admin/freeze",e);a&&(e.status=a,window.$message.success(s))},changePassword(e){this.openModal(e,"ChangePasswordModal")}}}),[["render",function(a,s,o,l,r,u){const m=p,f=C,w=e,g=S("FormModal"),v=S("ChangePasswordModal");return h(),t("div",null,[n(w,{subHeight:240,search:a.search,ref:"tables",onView:s[3]||(s[3]=e=>a.openModal({id:e.id,isEdit:!1},"formModal")),onEdit:s[4]||(s[4]=e=>a.openModal({id:e.id,isEdit:!0},"formModal")),onFreeze:a.freeze,url:"admin/api/admin/index",onChangePassword:a.changePassword,handle:a._handleBtn},{btn:i((()=>[a.$can("admin/create")?(h(),d(m,{key:0,quaternary:"",onClick:s[0]||(s[0]=e=>a.openModal({id:null,isEdit:!0},"formModal"))},{default:i((()=>[c(" 创建")])),_:1})):b("",!0)])),default:i((()=>[n(f,{value:a.search.phone,"onUpdate:value":s[1]||(s[1]=e=>a.search.phone=e),filterable:"",placeholder:"手机号码"},null,8,["value"]),n(f,{value:a.search.username,"onUpdate:value":s[2]||(s[2]=e=>a.search.username=e),filterable:"",placeholder:"用户名"},null,8,["value"])])),_:1},8,["search","onFreeze","onChangePassword","handle"]),n(g,{ref:"formModal"},null,512),n(v,{ref:"ChangePasswordModal"},null,512)])}]]);export{V as default};
